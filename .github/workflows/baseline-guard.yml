name: Baseline Guard / verifyExpected
on:
  pull_request:
  workflow_dispatch:
jobs:
  verifyExpected:
    name: Baseline Guard / verifyExpected
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Verify baseline files exist
        run: |
          echo "Checking baseline files from manifest.json..."
          
          # Check if manifest.json exists
          if [ ! -f "manifest.json" ]; then
            echo "::error::manifest.json not found"
            exit 1
          fi
          
          # Install jq if needed
          if ! command -v jq &> /dev/null; then
            sudo apt-get update -q
            sudo apt-get install -y jq
          fi
          
          # Extract baseline file paths from manifest.json
          BASELINE_FILES=$(jq -r '.artifacts[].path' manifest.json)
          
          if [ -z "$BASELINE_FILES" ]; then
            echo "::warning::No baseline files found in manifest.json"
          fi
          
          # Check each baseline file
          MISSING_FILES=()
          for file in $BASELINE_FILES; do
            if [ -f "$file" ]; then
              echo "✓ $file exists"
            else
              echo "::error::Missing baseline file: $file"
              MISSING_FILES+=("$file")
            fi
          done
          
          # Fail if any files are missing
          if [ ${#MISSING_FILES[@]} -ne 0 ]; then
            echo ""
            echo "::error::${#MISSING_FILES[@]} baseline file(s) missing:"
            printf '  - %s\n' "${MISSING_FILES[@]}"
            exit 1
          fi
          
          echo ""
          echo "✅ All baseline files verified successfully!"
