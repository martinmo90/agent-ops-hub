name: Open Auto-Merge Smoke PR

on:
  workflow_dispatch:
    inputs:
      base:
        description: "Base branch"
        required: false
        default: "main"
      title:
        description: "PR title"
        required: false
        default: "chore: smoke PR"
      body:
        description: "PR body"
        required: false
        default: "auto smoke"

permissions:
  contents: write
  pull-requests: write

concurrency:
  group: smoke-pr-${{ github.ref }}
  cancel-in-progress: true

jobs:
  create:
    name: create
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - name: Make change
        run: |
          ts=$(date +%Y%m%d-%H%M%S)
          br="chore/smoke-pr-$ts"
          echo "demo $ts" >> docs/OS_DEMO.md
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git config user.name "github-actions[bot]"
          git checkout -b "$br"
          git add -A
          git commit -m "chore: smoke $ts"
          git push origin "$br"
          echo "BR=$br" >> $GITHUB_ENV
      - name: Open PR
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh pr create --base "${{ inputs.base || 'main' }}" \
            --head "$BR" \
            --title "${{ inputs.title }}" \
            --body  "${{ inputs.body }}"
