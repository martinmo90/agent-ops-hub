name: PR Size Gate
run-name: "${{ github.workflow }} â€” #${{ github.event.pull_request.number }}"
on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  pull-requests: read
  contents: read

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  size-gate:
    runs-on: ubuntu-latest
    env:
      LIMIT: "800" # change threshold as you like
    steps:
      - name: Compute PR size
        run: |
          set -euo pipefail
          ev="${GITHUB_EVENT_PATH}"
          adds=$(jq -r '.pull_request.additions // 0' "$ev")
          dels=$(jq -r '.pull_request.deletions // 0' "$ev")
          total=$((adds + dels))
          echo "additions=$adds deletions=$dels total=$total"
          echo "Total changed lines: $total (limit: $LIMIT)"
          if [ "$total" -gt "$LIMIT" ]; then
            echo "::error ::PR too large ($total > $LIMIT)."
            exit 1
          fi
          echo "OK: within size gate."
